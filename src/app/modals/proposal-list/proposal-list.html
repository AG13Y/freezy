<div class="flex justify-between items-start">
  <h2 mat-dialog-title class="dark:text-white pb-0">
    Propostas Recebidas para: 
    <span class="text-indigo-600 dark:text-indigo-400">{{ project.titulo }}</span>
  </h2>
  <button mat-icon-button (click)="close()" class="mt-2 mr-2">
    <mat-icon class="dark:text-white">close</mat-icon>
  </button>
</div>

<mat-dialog-content class="space-y-4 max-h-[70vh]">
  
  @if (isLoading()) {
    <p class="text-gray-500 dark:text-gray-400 text-center p-8">Carregando propostas...</p>
  }

  <ul role="list" class="divide-y divide-gray-200 dark:divide-gray-700">
    @for (item of proposals(); track item.proposal.id) {
      <li class="flex flex-col sm:flex-row py-4 space-y-4 sm:space-y-0">
        <div class="sm:w-1/3 flex-shrink-0 pr-4">
          <div class="flex items-center">
            <img class="h-10 w-10 rounded-full object-cover" [src]="item.freelancer.fotoUrl || 'assets/icon-user.png'" alt="">
            <div class="ml-3">
              <p class="text-sm font-medium text-gray-900 dark:text-white">{{ item.freelancer.nome }}</p>
              <p class="text-sm text-gray-500 dark:text-gray-400">{{ item.freelancer.localizacao || 'Sem local' }}</p>
            </div>
          </div>
          <div class="mt-3 text-sm">
            <p class="text-gray-900 dark:text-white">
              Valor: <span class="font-bold">{{ item.proposal.valorProposto | currency: 'BRL' }}</span>
            </p>
            <p class="text-gray-700 dark:text-gray-300">
              Prazo: <span class="font-bold">{{ item.proposal.prazoEstimadoDias }} dias</span>
            </p>
          </div>
        </div>
        
        <div class="sm:w-2/3">
          <p class="text-sm text-gray-600 dark:text-gray-300 whitespace-pre-line">
            {{ item.proposal.mensagem }}
          </p>

          @if (item.proposal.attachedDocuments && item.proposal.attachedDocuments.length > 0) {
            <div class="mt-1">
              <h4 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase mb-2">
                Documentos Anexados
              </h4>
              <mat-chip-listbox>
                @for (doc of item.proposal.attachedDocuments; track doc.id) {
                  <a mat-chip [href]="doc.downloadUrl" target="_blank" 
                     class="!bg-indigo-50 dark:!bg-indigo-900 !text-indigo-700 dark:!text-indigo-300 hover:!bg-indigo-100 dark:hover:!bg-indigo-800 !cursor-pointer">
                    <mat-icon class="text-sm h-auto w-auto mr-1.5">
                      @switch (true) {
                        @case (doc.fileType.includes('pdf')) { picture_as_pdf }
                        @case (doc.fileType.includes('image')) { image }
                        @default { description }
                      }
                    </mat-icon>
                    {{ doc.fileName }}
                  </a>
                }
              </mat-chip-listbox>
            </div>
          }
        
          <div class="mt-3 text-right">
            <button (click)="acceptProposal(item)" mat-flat-button color="primary">
              Aceitar Proposta
            </button>
          </div>
        </div>
      </li>
    } @empty {
      @if (!isLoading()) {
        <p class="text-gray-500 dark:text-gray-400 text-center p-8">Nenhuma proposta recebida para este projeto ainda.</p>
      }
    }
  </ul>

</mat-dialog-content>
